#!/bin/bash

# This script will auto-generate all the necessary .mlpack files.
# From the top-level directory, run "mlpack".  It expects the source
# files to be in "src".

subdirs () {
    find $1 -maxdepth 1 -mindepth 1 -type d
}

submods () {
    find $1 -maxdepth 1 -mindepth 1 -type d -or -name "*.ml" \
        | awk -F/ '{print $NF}' | awk -F. '{print $1}'
}

helper () {
    rm -f $1.mlpack; submods $1 > $1.mlpack
    for SUBDIR in `subdirs $1`; do helper $SUBDIR ; done
}

helper src
rm -f src.mlpack
